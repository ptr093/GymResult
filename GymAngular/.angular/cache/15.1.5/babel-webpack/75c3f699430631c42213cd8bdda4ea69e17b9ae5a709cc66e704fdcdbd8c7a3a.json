{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component, ElementRef, ViewChildren } from '@angular/core';\nimport { FormControlName, Validators } from '@angular/forms';\nimport { debounceTime, fromEvent, merge } from 'rxjs';\nimport { GenericValidator } from '../generic-validator';\nlet WorkoutEditComponent = class WorkoutEditComponent {\n  constructor(fb, route, router, workoutService) {\n    this.fb = fb;\n    this.route = route;\n    this.router = router;\n    this.workoutService = workoutService;\n    this.pageTitle = 'Product Edit';\n    // Use with the generic validation message class\n    this.displayMessage = {};\n    // Defines all of the validation messages for the form.\n    // These could instead be retrieved from a file or database.\n    this.validationMessages = {\n      category: {\n        required: 'Product name is required.',\n        minlength: 'Product name must be at least three characters.',\n        maxlength: 'Product name cannot exceed 50 characters.'\n      },\n      weight: {\n        required: 'Product code is required.'\n      },\n      series: {\n        range: 'Rate the product between 1 (lowest) and 5 (highest).'\n      }\n    };\n    // Define an instance of the validator for use with this form,\n    // passing in this form's set of validation messages.\n    this.genericValidator = new GenericValidator(this.validationMessages);\n  }\n  ngOnInit() {\n    this.exerciseForm = this.fb.group({\n      category: ['', [Validators.required, Validators.minLength(3), Validators.maxLength(50)]],\n      weight: ['', Validators.required],\n      series: ['', Validators.required]\n    });\n    // Read the product Id from the route parameter\n    this.sub = this.route.paramMap.subscribe(params => {\n      const id = +params.get('id');\n      this.getExercise(id);\n    });\n  }\n  ngOnDestroy() {\n    this.sub.unsubscribe();\n  }\n  ngAfterViewInit() {\n    // Watch for the blur event from any input element on the form.\n    // This is required because the valueChanges does not provide notification on blur\n    const controlBlurs = this.formInputElements.map(formControl => fromEvent(formControl.nativeElement, 'blur'));\n    // Merge the blur event observable with the valueChanges observable\n    // so we only need to subscribe once.\n    merge(this.exerciseForm.valueChanges, ...controlBlurs).pipe(debounceTime(800)).subscribe(value => {\n      this.displayMessage = this.genericValidator.processMessages(this.exerciseForm);\n    });\n  }\n  getExercise(id) {\n    this.exerciseForm.getExercise(id).subscribe({\n      next: exercise => this.displayExercise(exercise),\n      error: err => this.errorMessage = err\n    });\n  }\n  displayExercise(exercise) {\n    if (this.exerciseForm) {\n      this.exerciseForm.reset();\n    }\n    this.exercise = this.exercise;\n    if (this.exercise?.id === 0) {\n      this.pageTitle = 'Dodaj cwiczenie';\n    } else {\n      this.pageTitle = `Edytuj trening: ${this.exercise?.category}`;\n    }\n    // Update the data on the form\n    this.exerciseForm.patchValue({\n      category: this.exerciseForm.category,\n      weight: this.exerciseForm.weight,\n      series: this.exerciseForm.series\n    });\n  }\n  deleteExercise() {\n    if (this.exercise?.id === 0) {\n      // Don't delete, it was never saved.\n      this.onSaveComplete();\n    } else {\n      if (confirm(`Really delete the product: ${this.exercise?.category}?`)) {\n        this.exerciseForm.deleteExercise(this.exercise?.category).subscribe({\n          next: () => this.onSaveComplete(),\n          error: err => this.errorMessage = err\n        });\n      }\n    }\n  }\n  saveExercise() {\n    if (this.exerciseForm.valid) {\n      if (this.exerciseForm.dirty) {\n        const p = {\n          ...this.exercise,\n          ...this.exerciseForm.value\n        };\n        if (p.id === 0) {\n          this.workoutService.createWorkout(p.idWorkout, p).subscribe({\n            next: () => this.onSaveComplete(),\n            error: err => this.errorMessage = err\n          });\n        } else {\n          this.workoutService.updateWorkout(p.idWorkout, p).subscribe({\n            next: () => this.onSaveComplete(),\n            error: err => this.errorMessage = err\n          });\n        }\n      } else {\n        this.onSaveComplete();\n      }\n    } else {\n      this.errorMessage = 'Please correct the validation errors.';\n    }\n  }\n  onSaveComplete() {\n    // Reset the form to clear the flags\n    this.exerciseForm.reset();\n    this.router.navigate(['/workout']);\n  }\n};\n__decorate([ViewChildren(FormControlName, {\n  read: ElementRef\n})], WorkoutEditComponent.prototype, \"formInputElements\", void 0);\nWorkoutEditComponent = __decorate([Component({\n  templateUrl: './workout-edit.component.html',\n  styleUrls: ['./workout-edit.component.css']\n})], WorkoutEditComponent);\nexport { WorkoutEditComponent };","map":{"version":3,"mappings":"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","names":["Component","ElementRef","ViewChildren","FormControlName","Validators","debounceTime","fromEvent","merge","GenericValidator","WorkoutEditComponent","constructor","fb","route","router","workoutService","validationMessages","category","required","minlength","maxlength","weight","series","range","genericValidator","ngOnInit","exerciseForm","group","minLength","maxLength","sub","paramMap","subscribe","params","id","get","getExercise","ngOnDestroy","unsubscribe","ngAfterViewInit","controlBlurs","formInputElements","map","formControl","nativeElement","valueChanges","pipe","value","displayMessage","processMessages","next","exercise","displayExercise","error","err","errorMessage","reset","pageTitle","patchValue","deleteExercise","onSaveComplete","confirm","saveExercise","valid","dirty","p","createWorkout","idWorkout","updateWorkout","navigate","__decorate","read","templateUrl","styleUrls"],"sourceRoot":"","sources":["D:\\repos\\GymResult\\GymAngular\\src\\app\\workout\\workout-edit.component.ts"],"sourcesContent":["import { AfterViewInit, Component, ElementRef, OnDestroy, OnInit, ViewChildren } from '@angular/core';\nimport { FormBuilder, FormControlName, FormGroup, Validators } from '@angular/forms';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { debounceTime, fromEvent, merge, Observable, Subscription } from 'rxjs';\nimport { GenericValidator } from '../generic-validator';\nimport { WorkoutService } from '../workout.service';\nimport { Exerceise } from './exercise';\n\n@Component({\n\n  templateUrl: './workout-edit.component.html',\n  styleUrls: ['./workout-edit.component.css']\n})\nexport class WorkoutEditComponent implements  OnInit, AfterViewInit, OnDestroy  {\n  @ViewChildren(FormControlName, { read: ElementRef }) formInputElements: ElementRef[] | undefined;\n\n  pageTitle = 'Product Edit';\n  errorMessage: string | undefined;\n  exerciseForm: FormGroup | undefined;\n\n  exercise: Exerceise | undefined;\n  private sub: Subscription | undefined;\n\n  // Use with the generic validation message class\n  displayMessage: { [key: string]: string } = {};\n  private validationMessages: { [key: string]: { [key: string]: string } };\n  private genericValidator: GenericValidator;\n\n\n\n  constructor(private fb: FormBuilder,\n              private route: ActivatedRoute,\n              private router: Router,\n              private workoutService: WorkoutService) {\n\n    // Defines all of the validation messages for the form.\n    // These could instead be retrieved from a file or database.\n    this.validationMessages = {\n      category: {\n        required: 'Product name is required.',\n        minlength: 'Product name must be at least three characters.',\n        maxlength: 'Product name cannot exceed 50 characters.'\n      },\n      weight: {\n        required: 'Product code is required.'\n      },\n      series: {\n        range: 'Rate the product between 1 (lowest) and 5 (highest).'\n      }\n    };\n\n    // Define an instance of the validator for use with this form,\n    // passing in this form's set of validation messages.\n    this.genericValidator = new GenericValidator(this.validationMessages);\n  }\n\n  ngOnInit(): void {\n    this.exerciseForm = this.fb.group({\n      category: ['', [Validators.required,\n                         Validators.minLength(3),\n                         Validators.maxLength(50)]],\n      weight: ['', Validators.required],\n      series: ['', Validators.required]\n   \n    });\n\n    // Read the product Id from the route parameter\n    this.sub = this.route.paramMap.subscribe(\n      params => {\n        const id = +params.get('id');\n        this.getExercise(id);\n      }\n    );\n  }\n\n  ngOnDestroy(): void {\n    this.sub.unsubscribe();\n  }\n\n  ngAfterViewInit(): void {\n    // Watch for the blur event from any input element on the form.\n    // This is required because the valueChanges does not provide notification on blur\n    const controlBlurs: Observable<any>[] = this.formInputElements\n      .map((formControl: ElementRef) => fromEvent(formControl.nativeElement, 'blur'));\n\n    // Merge the blur event observable with the valueChanges observable\n    // so we only need to subscribe once.\n    merge(this.exerciseForm.valueChanges, ...controlBlurs).pipe(\n      debounceTime(800)\n    ).subscribe(value => {\n      this.displayMessage = this.genericValidator.processMessages(this.exerciseForm);\n    });\n  }\n\n  \n\n\n  getExercise(id: number): void {\n    this.exerciseForm.getExercise(id)\n      .subscribe({\n        next: (exercise: Exerceise) => this.displayExercise(exercise),\n        error: (err: string) => this.errorMessage = err\n      });\n  }\n\n  displayExercise(exercise: Exerceise): void {\n    if (this.exerciseForm) {\n      this.exerciseForm.reset();\n    }\n    this.exercise = this.exercise;\n\n    if (this.exercise?.id === 0) {\n      this.pageTitle = 'Dodaj cwiczenie';\n    } else {\n      this.pageTitle = `Edytuj trening: ${this.exercise?.category}`;\n    }\n\n    // Update the data on the form\n    this.exerciseForm.patchValue({\n      category: this.exerciseForm.category,\n      weight: this.exerciseForm.weight,\n      series: this.exerciseForm.series,\n     \n    });\n   \n  }\n\n  deleteExercise(): void {\n    if (this.exercise?.id === 0) {\n      // Don't delete, it was never saved.\n      this.onSaveComplete();\n    } else {\n      if (confirm(`Really delete the product: ${this.exercise?.category}?`)) {\n        this.exerciseForm.deleteExercise(this.exercise?.category)\n          .subscribe({\n            next: () => this.onSaveComplete(),\n            error: (err: string) => this.errorMessage = err\n          });\n      }\n    }\n  }\n\n  saveExercise(): void {\n    if (this.exerciseForm.valid) {\n      if (this.exerciseForm.dirty) {\n        const p = { ...this.exercise, ...this.exerciseForm.value };\n\n        if (p.id === 0) {\n          this.workoutService.createWorkout(p.idWorkout,p)\n            .subscribe({\n              next: () => this.onSaveComplete(),\n              error: err => this.errorMessage = err\n            });\n        } else {\n          this.workoutService.updateWorkout(p.idWorkout, p)\n            .subscribe({\n              next: () => this.onSaveComplete(),\n              error: err => this.errorMessage = err\n            });\n        }\n      } else {\n        this.onSaveComplete();\n      }\n    } else {\n      this.errorMessage = 'Please correct the validation errors.';\n    }\n  }\n\n  onSaveComplete(): void {\n    // Reset the form to clear the flags\n    this.exerciseForm.reset();\n    this.router.navigate(['/workout']);\n  }\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}